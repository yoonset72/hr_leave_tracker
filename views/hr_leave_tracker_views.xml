<?xml version="1.0" encoding="utf-8"?>
<odoo>


    <!-- Employee Leave Balance Overview Tree View -->
    <record id="view_hr_employee_leave_overview_tree" model="ir.ui.view">
        <field name="name">hr.employee.leave.overview.tree</field>
        <field name="model">hr.employee.leave.overview</field>
        <field name="arch" type="xml">
            <tree string="Employee Leave Overview">
                <field name="employee_number"/>
                <field name="employee_name"/>
                <field name="department_id"/>
                
                <field name="casual_balance" decoration-danger="1"/>
                <field name="annual_balance" decoration-danger="1"/>
                <field name="medical_balance" decoration-danger="1"/>
                <field name="unpaid_balance" decoration-danger="1"/>
                <field name="funeral_balance" decoration-danger="1"/>
                <field name="marriage_balance" decoration-danger="1"/>
                <field name="maternity_balance" decoration-danger="1"/>
                <field name="paternity_balance" decoration-danger="1"/>
            </tree>
        </field>
    </record>


    <record id="view_hr_employee_leave_overview_form" model="ir.ui.view">
        <field name="name">hr.employee.leave.overview.form</field>
        <field name="model">hr.employee.leave.overview</field>
        <field name="arch" type="xml">
            <form string="Employee Leave Overview">
                <sheet>
                    <!-- Employee Info -->
                    <group>
                        <field name="employee_number"/>
                        <field name="employee_name"/>
                        <field name="department_name"/>
                    </group>

                    <!-- Leave Balances Table -->
                    <group string="Leave Balances">
                        <table class="table table-sm o_td_label">
                            <thead>
                                <tr>
                                    <th>Leave Type</th>
                                    <th>Total</th>
                                    <th>Taken</th>
                                    <th>Balance</th>
                                    <th>Pending</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Annual</td>
                                    <td>
                                        <span style="color:red;"><field name="annual_total"/>
                                            <span style="color:black"> (Carry <field name="annual_carry"/>/ Expired <field name="expired_carry"/>)</span>
                                        </span>
                                    </td>
                                    <td><span style="color:red;"><field name="annual_taken"/></span></td>
                                    <td><span style="color:red;"><field name="annual_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="annual_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Casual</td>
                                    <td><span style="color:red;"><field name="casual_total"/></span></td>
                                    <td><span style="color:red;"><field name="casual_taken"/></span></td>
                                    <td><span style="color:red;"><field name="casual_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="casual_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Medical</td>
                                    <td><span style="color:red;"><field name="medical_total"/></span></td>
                                    <td><span style="color:red;"><field name="medical_taken"/></span></td>
                                    <td><span style="color:red;"><field name="medical_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="medical_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Funeral</td>
                                    <td><span style="color:red;"><field name="funeral_total"/></span></td>
                                    <td><span style="color:red;"><field name="funeral_taken"/></span></td>
                                    <td><span style="color:red;"><field name="funeral_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="funeral_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Marriage</td>
                                    <td><span style="color:red;"><field name="marriage_total"/></span></td>
                                    <td><span style="color:red;"><field name="marriage_taken"/></span></td>
                                    <td><span style="color:red;"><field name="marriage_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="marriage_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Unpaid</td>
                                    <td><span style="color:red;"><field name="unpaid_total"/></span></td>
                                    <td><span style="color:red;"><field name="unpaid_taken"/></span></td>
                                    <td><span style="color:red;"><field name="unpaid_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="unpaid_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Maternity</td>
                                    <td><span style="color:red;"><field name="maternity_total"/></span></td>
                                    <td><span style="color:red;"><field name="maternity_taken"/></span></td>
                                    <td><span style="color:red;"><field name="maternity_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="maternity_pending"/></span></td>
                                </tr>
                                <tr>
                                    <td>Paternity</td>
                                    <td><span style="color:red;"><field name="paternity_total"/></span></td>
                                    <td><span style="color:red;"><field name="paternity_taken"/></span></td>
                                    <td><span style="color:red;"><field name="paternity_balance" readonly="1"/></span></td>
                                    <td><span style="color:red;"><field name="paternity_pending"/></span></td>
                                </tr>
                            </tbody>
                        </table>
                    </group>
                </sheet>
            </form>
        </field>
    </record>





    <!-- Action to open tree view -->
    <record id="action_hr_employee_leave_overview" model="ir.actions.act_window">
        <field name="name">Employee Leave Overview</field>
        <field name="res_model">hr.employee.leave.overview</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_hr_employee_leave_overview_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No employee leave data found
            </p>
            <p>
                This view shows a comprehensive overview of all employee leave balances.
                Click on any balance to view detailed breakdown (Total, Taken, Balance, Pending).
            </p>
        </field>
    </record>

    <!-- Leave Tracker Form View - FULLY EDITABLE -->
    <record id="view_hr_leave_tracker_form" model="ir.ui.view">
    <field name="name">hr.leave.tracker.form</field>
    <field name="model">hr.leave.tracker</field>
    <field name="arch" type="xml">
        <form string="Leave Tracker">
            <sheet>
                <!-- Employee Selection -->
                <group string="Employee Selection">
                    <field name="employee_id" options="{'no_create': False, 'no_open': False}"/>
                    <field name="leave_type_id" options="{'no_create': False, 'no_open': False}"/>
                    <field name="year"/>
                </group>

                <!-- Leave Data -->
                <group string="Leave Data">
                    <!-- Show total_dynamic only for Annual Leave -->
                    <field name="total_dynamic"
                           attrs="{'invisible': [('leave_type_name', '!=', 'Annual Leave')]}"/>
                    
                    <!-- Show total_allocation for all other leave types -->
                    <field name="total_allocation"
                           attrs="{'invisible': [('leave_type_name', '=', 'Annual Leave')]}"/>
                    
                    <!-- Taken Leaves Display -->
                    <field name="taken_display" readonly="1"
                           string="Taken (Cutoff Applied)"
                           help="Displays taken leaves. For Annual Leave, shows system-calculated leaves after June 30; otherwise shows taken leaves"/>

                    <field name="pending_requests"/>
                    
                    <!-- Current balance dynamically computed -->
                    <field name="current_balance" readonly="1"
                           help="Automatically calculated as Total Allocation or Dynamic Total minus Taken Leaves"/>
                    
                    <!-- Annual leave carry info -->
                    <field name="annual_carry"/>
                    <field name="expired_carry"/>
                </group>

                <!-- Computed Info -->
                <group string="Computed Information" states="readonly">
                    <field name="name" readonly="1"/>
                    <field name="employee_name" readonly="1"/>
                    <field name="employee_number" readonly="1"/>
                    <field name="leave_type_name" readonly="1"/>
                </group>
            </sheet>
        </form>
    </field>
</record>



    <!-- Leave Tracker Tree View - FULLY EDITABLE -->
    <record id="view_hr_leave_tracker_tree" model="ir.ui.view">
        <field name="name">hr.leave.tracker.tree</field>
        <field name="model">hr.leave.tracker</field>
        <field name="arch" type="xml">
            <tree string="Leave Trackers" create="true" edit="true" delete="true" editable="bottom">
                <!-- Header button removed to prevent ParseError -->
                
                <field name="employee_id" required="1"/>
                <field name="employee_number" string="Employee ID" readonly="1"/>
                <field name="department_id" string="Department" readonly="1"/>
                <field name="leave_type_id" required="1"/>
                <field name="year"/>
                
                <!-- Total column -->
                <field name="display_total" string="Total"/>
                
                <field name="taken_display"/>
                <field name="pending_requests"/>
                <field name="current_balance" readonly="1"
                    decoration-danger="current_balance &lt;= 0"
                    decoration-warning="current_balance &gt; 0 and current_balance &lt; 3"/>
                <field name="annual_carry" readonly="1"/>
                <field name="expired_carry" readonly="1"/>
                
                <!-- Reference fields (hidden) -->
                <field name="employee_name" invisible="1"/>
                <field name="leave_type_name" invisible="1"/>
            </tree>
        </field>
    </record>





    <!-- Search Views -->
    <record id="view_hr_employee_leave_overview_search" model="ir.ui.view">
        <field name="name">hr.employee.leave.overview.search</field>
        <field name="model">hr.employee.leave.overview</field>
        <field name="arch" type="xml">
            <search string="Employee Leave Overview">
                <field name="employee_name"/>
                <field name="employee_number"/>
                <field name="department_id"/>
                
                <filter string="Low Casual Balance" name="low_casual" 
                        domain="[('casual_balance', '&lt;', 3)]"/>
                <filter string="Low Annual Balance" name="low_annual" 
                        domain="[('annual_balance', '&lt;', 3)]"/>
                <filter string="Critical Balances" name="critical" 
                        domain="['|', ('casual_balance', '&lt;=', 0), ('annual_balance', '&lt;=', 0)]"/>
                
                <group expand="0" string="Group By">
                     <filter string="Department" name="group_department" context="{'group_by': 'department_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <record id="view_hr_leave_tracker_search" model="ir.ui.view">
        <field name="name">hr.leave.tracker.search</field>
        <field name="model">hr.leave.tracker</field>
        <field name="arch" type="xml">
            <search string="Leave Trackers">
                <field name="employee_name"/>
                <field name="employee_number"/>
                <field name="department_id"/>
                <field name="year"/>
                <field name="leave_type_name"/>
                <field name="employee_id"/>
                <field name="leave_type_id"/>
                
                <filter string="Current Year" name="current_year" 
                        domain="[('year', '=', context_today().strftime('%Y'))]"/>
                <filter string="Low Balance" name="low_balance" 
                        domain="[('current_balance', '&lt;', 3)]"/>
                <filter string="Critical Balance" name="critical_balance" 
                        domain="[('current_balance', '&lt;=', 0)]"/>
                
                <separator/>
                <group expand="0" string="Group By">
                    <filter string="Employee" name="group_employee" context="{'group_by': 'employee_id'}"/>
                    <filter string="Year" name="group_year" context="{'group_by': 'year'}"/>
                    <filter string="Leave Type" name="group_leave_type" context="{'group_by': 'leave_type_id'}"/>
                     <filter string="Department" name="group_department" context="{'group_by': 'department_id'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Actions -->
    <record id="action_hr_employee_leave_overview" model="ir.actions.act_window">
        <field name="name">Employee Leave Balance Overview</field>
        <field name="res_model">hr.employee.leave.overview</field>
        <field name="view_mode">tree,form</field>
        <field name="view_id" ref="view_hr_employee_leave_overview_tree"/>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                No employee leave data found
            </p>
            <p>
                This view shows a comprehensive overview of all employee leave balances.
                Click on any balance to view detailed breakdown (Total, Taken, Balance, Pending).
            </p>
        </field>
    </record>

    <record id="action_hr_leave_tracker" model="ir.actions.act_window">
        <field name="name">Leave Trackers</field>
        <field name="res_model">hr.leave.tracker</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_current_year': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create a new leave tracker record
            </p>
            <p>
                Track and manage employee leave balances for different leave types.
            </p>
        </field>
    </record>


    <!-- Menu Items -->
    <menuitem id="menu_hr_leave_tracker_root"
              name="Leave Tracker"
              parent="hr_holidays.menu_hr_holidays_root"
              sequence="15"/>
              
    <menuitem id="menu_hr_employee_leave_overview"
              name="Employee Balance Overview"
              parent="menu_hr_leave_tracker_root"
              action="action_hr_employee_leave_overview"
              sequence="5"/>
              
    <menuitem id="menu_hr_leave_tracker"
              name="Leave Trackers"
              parent="menu_hr_leave_tracker_root"
              action="action_hr_leave_tracker"
              sequence="10"/>
              
</odoo>